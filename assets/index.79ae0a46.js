import{a as P,p as X}from"./vendor.5f31fa66.js";class k{static registerScreen(t){this.screens.set(t.id,t)}static getScreen(t){return this.screens.get(t)}static showScreen(t){this.currentScreen.push(t)}static switchScreen(t){this.currentScreen=[t]}static removeScreen(){this.currentScreen.pop()}static getCurrentScreen(){return this.currentScreen[this.currentScreen.length-1]}static draw(){this.currentScreen.forEach(t=>{t.draw()})}}k.screens=new Map,k.currentScreen=new Array;class x{constructor(){this.settings={}}static getInstance(){return x.instance||(x.instance=new x),x.instance}getSetting(t){return this.settings[t]}setSetting(t,s){this.settings[t]=s,this.saveSettingsToCookies()}saveSettingsToCookies(){const t=JSON.stringify(this.settings);document.cookie=`settings=${t}`}loadSettingsFromCookies(){const s=document.cookie.split(";").find(i=>i.trim().startsWith("settings="));if(s){const i=s.split("=")[1];this.settings=JSON.parse(i)}}}class O{constructor(t,s,i,e,o=!1,h=!1){this.start=t,this.direction=s,this.speed=i,this.damage=e,this.pass=o,this.ray=h,this.hit=!1,this.x=t.x,this.y=t.y;const l=Math.sqrt(s.dx**2+s.dy**2);this.direction.dx=s.dx/l*i,this.direction.dy=s.dy/l*i}draw(){if(this.x+=this.direction.dx,this.y+=this.direction.dy,this.ray){const t=this.start.x+this.direction.dx*1e3,s=this.start.y+this.direction.dy*1e3,i=N({p1:this.start,p2:{x:t,y:s}},{minX:540,minY:40,maxX:1540,maxY:1040});if(!i)return;r.stroke("#000000").line(this.start.x,this.start.y,i.x,i==null?void 0:i.y).noStroke(),this.hit=!0}else r.fill("#000000").circle(this.x,this.y,6)}shouldRemove(){return n.checkInMap(this.x,this.y)?this.pass?this.damage<=0:this.hit:!0}}function N(a,t){const s=a.p1.x,i=a.p1.y,e=a.p2.x,o=a.p2.y;if(s===e){if(s<t.minX||s>t.maxX)return null;const c=Math.max(t.minY,Math.min(t.maxY,Math.max(i,o)));return{x:s,y:c}}const h=(o-i)/(e-s),l=i-h*s;if(h!==0){const c=Math.max(t.minX,Math.min(t.maxX,(t.minY-l)/h)),w=Math.max(t.minX,Math.min(t.maxX,(t.maxY-l)/h));if(c>=s&&c<=e||w>=s&&w<=e){const u=e>s?c:w,m=h*u+l;return{x:u,y:m}}}return null}class Y{constructor(t,s,i,e,o,h="#ffffff",l="#dddddd",c="#aaaaaa",w,u=!1,m){var S,C,y,p;this.mouseDownHandler=[],this.mouseUpHandler=[],this.mouseHoverHandler=[],this.mouseInHandler=[],this.mouseOutHandler=[],this.onClickedHandler=[],this.mouseHovering=!1,this.id=(S=m!=null?m:`${o==null?void 0:o.id}-button-${t}-${s}`)!=null?S:`bare-button-${t}-${s}`,this.x=u?(C=o==null?void 0:o.x)!=null?C:0+t:t,this.y=u?(y=o==null?void 0:o.y)!=null?y:0+s:s,this.width=i,this.height=e,this.defaultColor=h,this.renderColor=h,this.hoverColor=l,this.clickColor=c,this.visible=(p=w!=null?w:o==null?void 0:o.visible)!=null?p:!0,this.parent=o!=null?o:this}draw(){!this.visible||r.fill(this.renderColor).rect(this.x,this.y,this.width,this.height,5)}mouseDown(){this.renderColor=this.clickColor,this.mouseDownHandler.forEach(t=>t())}mouseUp(){this.renderColor=this.defaultColor,this.mouseUpHandler.forEach(t=>t())}onClicked(){this.onClickedHandler.forEach(t=>t())}onHover(){this.renderColor=this.hoverColor,this.mouseHoverHandler.forEach(t=>t())}onMouseIn(){this.mouseHovering=!0,this.mouseInHandler.forEach(t=>t())}onMouseOut(){this.renderColor=this.defaultColor,this.mouseHovering=!1,this.mouseOutHandler.forEach(t=>t())}}class d{constructor(t,s,i,e,o,h,l="#000000",c="#000000",w="#000000",u,m=!1,S){var C,y,p,L;this.mouseDownHandler=[],this.mouseUpHandler=[],this.mouseHoverHandler=[],this.mouseInHandler=[],this.mouseOutHandler=[],this.onClickedHandler=[],this.mouseHovering=!1,this.text=t,this.id=(C=S!=null?S:`${h==null?void 0:h.id}-text-${s}-${i}-${t}`)!=null?C:`bare-text-${s}-${i}-${t}`,this.x=m?(y=h==null?void 0:h.x)!=null?y:0+s:s,this.y=m?(p=h==null?void 0:h.y)!=null?p:0+i:i,this.width=e,this.height=o,this.defaultColor=l,this.renderColor=l,this.hoverColor=c,this.clickColor=w,this.visible=(L=u!=null?u:h==null?void 0:h.visible)!=null?L:!0,this.parent=h!=null?h:this}draw(){if(!this.visible)return;const t=Math.min(this.width/4,this.height/2);r.fill(this.renderColor).textSize(t).textAlign(r.CENTER,r.CENTER).text(this.text,this.x,this.y,this.width,this.height)}updateText(t){this.text=t}mouseDown(){this.renderColor=this.clickColor,this.mouseDownHandler.forEach(t=>t())}mouseUp(){this.renderColor=this.defaultColor,this.mouseUpHandler.forEach(t=>t())}onClicked(){this.onClickedHandler.forEach(t=>t())}onHover(){this.mouseHoverHandler.forEach(t=>t())}onMouseIn(){this.mouseHovering=!0,this.renderColor=this.hoverColor,this.mouseInHandler.forEach(t=>t())}onMouseOut(){this.renderColor=this.defaultColor,this.mouseHovering=!1,this.mouseOutHandler.forEach(t=>t())}}class v extends Y{constructor(t,s,i,e,o,h,l="#ffffff",c="#dddddd",w="#aaaaaa",u,m=!1,S){super(t,s,i,e,h,l,c,w,u,m,S);const C=this.width*.1,y=this.height*.08;this.text=new d(o,this.x+C,this.y+y,this.width-C*2,this.height-y*2,this)}draw(){!this.visible||(super.draw(),this.text.draw())}}class A{constructor(){this.id="base-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=new Array,this.init()}init(){throw new Error("Method not implemented.")}draw(){!this.visible||this.components.forEach(t=>{t.draw()})}mouseClicked(t,s){var i;(i=this.components.filter(e=>"onClicked"in e).filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.onClicked(t,s)}mouseDown(t,s){var i;(i=this.components.filter(e=>"mouseDown"in e).filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.mouseDown(t,s)}mouseUp(t,s){var i;(i=this.components.filter(e=>"mouseUp"in e).filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.mouseUp(t,s)}mouseMoved(t,s){var i;(i=this.components.filter(e=>"onHover"in e).filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.onHover(t,s),this.components.filter(e=>"onHover"in e).forEach(e=>{t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height?e.mouseHovering||e.onMouseIn(t,s):e.mouseHovering&&e.onMouseOut(t,s)})}}var G="/assets/help.fde16cdb.png";class z extends A{constructor(){super();this.id="help-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[],z.instance=this,this.init(),this.helpImage=r.loadImage(G)}init(){const t=new d("Game Help",Math.round(f*.4),Math.round(g*.02),Math.round(f*.2),Math.round(g*.1),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"help-title");this.components.push(t);const s=new v(Math.round(f*.02),Math.round(g*.02),Math.round(f*.14),Math.round(g*.08),"Back",this);this.components.push(s),s.onClickedHandler.push(()=>{k.switchScreen(M.instance)})}draw(){!this.visible||(this.components.forEach(t=>{t.draw()}),r.image(this.helpImage,f*.02,g*.14,f*.96,g*.84))}}var V="/assets/bgm.146a0df4.mp3";class j{constructor(t,s,i,e,o="#ffffff",h="#07D270",l,c=!1,w,u=!1){var m,S,C,y;this.checked=!1,this.onClickedHandler=[],this.mouseDownHandler=[],this.mouseUpHandler=[],this.id=(m=w!=null?w:`${e==null?void 0:e.id}-button-${t}-${s}`)!=null?m:`bare-button-${t}-${s}`,this.x=c?(S=e==null?void 0:e.x)!=null?S:0+t:t,this.y=c?(C=e==null?void 0:e.y)!=null?C:0+s:s,this.width=i,this.height=i,this.defaultColor=o,this.checkedColor=h,this.visible=(y=l!=null?l:e==null?void 0:e.visible)!=null?y:!0,this.parent=e!=null?e:this,this.checked=u!=null?u:!1}draw(){let t=this.height;if(r.fill(this.defaultColor).stroke(0).strokeWeight(1).rect(this.x,this.y,t,t).noStroke(),this.checked){const s=t*.05;t*=.9,r.fill(this.checkedColor).noStroke().rect(this.x+s,this.y+s,t,t)}}onClicked(){this.checked=!this.checked,this.onClickedHandler.forEach(t=>t())}mouseDown(){}mouseUp(){}}class U extends j{constructor(t,s,i,e,o,h,l=!1,c="#ffffff",w="#07D270",u="#ffffff",m,S=!1,C){super(t,s,e,h,c,w,m,S,C,l);this.width=i,this.text=new d(o,t+e,s,i-e,e,this,u)}draw(){super.draw(),this.text.draw()}}class E extends A{constructor(){super();this.id="settings-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[],E.instance=this,this.bgm=new Audio(V),this.init()}init(){const t=new d("Game Settings",Math.round(f*.4),Math.round(g*.02),Math.round(f*.2),Math.round(g*.1),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"settings-title");this.components.push(t),x.getInstance().getSetting("backgroundMusic")==="on"&&x.getInstance().setSetting("backgroundMusic","off");const s=new U(576,324,768,50,"Enable Background Music",this,x.getInstance().getSetting("backgroundMusic")==="on");this.components.push(s),s.onClickedHandler.push(()=>{x.getInstance().setSetting("backgroundMusic",s.checked?"on":"off"),this.bgm.currentTime=0,s.checked?this.bgm.play():this.bgm.pause()});const i=new U(576,384,768,50,"Show Enemy Path",this,x.getInstance().getSetting("showEnemyPath")==="on");this.components.push(i),i.onClickedHandler.push(()=>{x.getInstance().setSetting("showEnemyPath",i.checked?"on":"off")});const e=new v(Math.round(f*.02),Math.round(g*.02),Math.round(f*.14),Math.round(g*.08),"Back",this);this.components.push(e),e.onClickedHandler.push(()=>{k.switchScreen(M.instance)})}draw(){!this.visible||this.components.forEach(t=>{t.draw()})}}class M extends A{constructor(){super();this.id="main-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[],M.instance=this,this.init()}init(){const t=new d("Prosperity TD",Math.round(f*.4),Math.round(g*.1),Math.round(f*.2),Math.round(g*.2),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"main-title");this.components.push(t);const s=new v(Math.round(f*.43),Math.round(g*.34),Math.round(f*.14),Math.round(g*.08),"Play",this);this.components.push(s),s.onClickedHandler.push(()=>{H.instance.init(),k.switchScreen(H.instance),console.log("Play Button Clicked")});const i=new v(Math.round(f*.43),Math.round(g*.44),Math.round(f*.14),Math.round(g*.08),"Settings",this);this.components.push(i),i.onClickedHandler.push(()=>{k.switchScreen(E.instance),console.log("Settings Button Clicked")});const e=new v(Math.round(f*.43),Math.round(g*.54),Math.round(f*.14),Math.round(g*.08),"Help",this);this.components.push(e),e.onClickedHandler.push(()=>{k.switchScreen(z.instance),console.log("Help Button Clicked")});const o=new v(Math.round(f*.43),Math.round(g*.64),Math.round(f*.14),Math.round(g*.08),"Credits",this);this.components.push(o),o.onClickedHandler.push(()=>{console.log("Credits Button Clicked")});const h=new d("Version: 0.0.1",Math.round(f*.9),Math.round(g*.95),Math.round(f*.1),Math.round(g*.05),this,"#ffffff","#ffffff","#ffffff");this.components.push(h)}draw(){!this.visible||this.components.forEach(t=>{t.draw()})}}class _{constructor(t){this.difficulty=t,this.x=565,this.y=65,this.speed=1,this.health=100,this.maxHealth=100,this.armor=0,this.attack=0,this.color=[Math.floor(Math.random()*255),Math.floor(Math.random()*255),Math.floor(Math.random()*255)],this.diameter=Math.random()*10+5,this.speed=(1+Math.random()*t*.3)/3,this.speed>10&&(this.speed=10),this.health=-1+Math.random()*t*.05,this.armor=Math.random()*t*.02,this.attack=Math.random()*t*.01}hurt(t){this.health-=t-this.armor,this.health<=0&&this.death()}death(){n.addMoney(Math.floor(5+Math.random()*this.difficulty*10)),n.enemies.splice(n.enemies.indexOf(this),1)}doAttack(){n.life-=this.attack,console.log(this),this.death(),n.life<=0&&k.switchScreen(M.instance)}draw(){if(Number.isNaN(this.x)||Number.isNaN(this.y))return;r.fill(this.color).circle(this.x,this.y,this.diameter);const t=this.getVelocity(n.path);this.x+=t.dx,this.y+=t.dy}getVelocity(t){const s=n.getCellfromCoord(this.x,this.y);if(s.y===t[t.length-1][0]&&s.x===t[t.length-1][1])return this.doAttack(),{dx:0,dy:0};const i=t.findIndex(m=>m[1]===s.y&&m[0]===s.x)+1;if(i===0){const m=t.reduce((S,C)=>{const y=Math.abs(S[1]-s.y)+Math.abs(S[0]-s.x),p=Math.abs(C[1]-s.y)+Math.abs(C[0]-s.x);return y<p?S:C});return this.x=565+m[0]*n.grid.cellSize,this.y=65+m[1]*n.grid.cellSize,{dx:0,dy:0}}const e=t[i];if(!e)return this.doAttack(),{dx:0,dy:0};const o={x:565+e[0]*n.grid.cellSize,y:65+e[1]*n.grid.cellSize},h=o.x-this.x,l=o.y-this.y,c=Math.sqrt(h*h+l*l),w=h/c*this.speed,u=l/c*this.speed;return{dx:w,dy:u}}}class I{constructor(){this.level=0,this.baseAttack=3,this.attackPerLevel=5,this.baseAttackSpeed=.5,this.attackSpeedPerLevel=.3,this.bulletSpeed=2,this.baseCost=320,this.CostAmplifier=2,this.baseRange=150,this.rangePerLevel=100,this.info="A tower with a moderate attack but can go through enemies."}draw(t,s,i){i*=.5,r.fill("#D522A3").circle(t,s,i)}get attack(){return this.baseAttack+this.level*this.attackPerLevel}get attackSpeed(){return this.baseAttackSpeed+this.level*this.attackSpeedPerLevel}get range(){return this.baseRange+this.level*this.rangePerLevel}get upgradeCost(){return this.baseCost*this.CostAmplifier**(this.level+1)}get totalCost(){return this.baseCost*this.CostAmplifier**this.level}copy(){const t=new I;return t.level=this.level,t}}class ${constructor(){this.level=0,this.baseAttack=1,this.attackPerLevel=1,this.baseAttackSpeed=6,this.attackSpeedPerLevel=4,this.bulletSpeed=10,this.baseCost=600,this.CostAmplifier=2,this.baseRange=300,this.rangePerLevel=200,this.info="A lazer tower with super high attack speed."}draw(t,s,i){i*=.4,r.fill("#BC0AFB").circle(t,s,i)}get attack(){return this.baseAttack+this.level*this.attackPerLevel}get attackSpeed(){return this.baseAttackSpeed+this.level*this.attackSpeedPerLevel}get range(){return this.baseRange+this.level*this.rangePerLevel}get upgradeCost(){return this.baseCost*this.CostAmplifier**(this.level+1)}get totalCost(){return this.baseCost*this.CostAmplifier**this.level}copy(){const t=new $;return t.level=this.level,t}}class B{constructor(t,s,i){this.cellSize=i,this.rows=t,this.cols=s}isValidCell(t){return t.x>=0&&t.x<this.cols&&t.y>=0&&t.y<this.rows}}class q{constructor(t){this.parent=t,this.id="game-map",this.x=540,this.y=40,this.width=-1,this.height=-1,this.visible=!0,this.grid=new B(20,20,50),this.towers=[],this.enemies=[],this.bullets=[],this.money=200,this.life=100,this.wave=0,this.path=[],this.counter=0,this.refresh()}refresh(){this.towers=[],this.enemies=[],this.bullets=[],this.money=600,this.life=100,this.wave=0,this.grid=new B(20,20,50);const t=new P.AStarFinder({grid:{matrix:this.getGridArray()},diagonalAllowed:!1,allowPathAsCloseAsPossible:!0});this.path=t.findPath({x:0,y:0},{x:this.grid.rows-1,y:this.grid.cols-1})}draw(){this.counter%60==0&&(this.money+=1),this.counter%600==0&&(this.life+=10,this.generateNewWave()),this.counter>=72e3&&(this.counter=0),this.counter+=1,r.stroke(0);for(let t=this.x;t<=this.x+this.grid.cols*this.grid.cellSize;t+=this.grid.cellSize)r.line(t,this.y,t,this.y+this.grid.cellSize*this.grid.rows);for(let t=this.y;t<=this.y+this.grid.rows*this.grid.cellSize;t+=this.grid.cellSize)r.line(this.x,t,this.x+this.grid.cellSize*this.grid.cols,t);if(r.noStroke(),r.fill("#FA6A6A").circle(this.x+25,this.y+25,40),r.fill("#07D270").circle(this.x+975,this.y+975,40),this.enemies.forEach(t=>{t.draw()}),this.towers.forEach(({coord:t,tower:s,bullets:i})=>{if(s.draw(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2,this.y+this.grid.cellSize*t.y+this.grid.cellSize/2,40),this.counter%Math.floor(60/s.attackSpeed)==0){const e=this.tryGenerateBullet(t,s);e&&(i==null||i.push(e))}i==null||i.forEach(e=>{e.draw()}),i.splice(0,i.length,...i.filter(e=>e.shouldRemove()===!1)),i.forEach(e=>{if(e.ray){const h=this.enemies.find(l=>Math.abs(l.x-(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2))<=s.range&&Math.abs(l.y-(this.y+this.grid.cellSize*t.y+this.grid.cellSize/2))<=s.range);if(h){const l=e.damage,c=h.health;e.damage-=c,h.hurt(l),e.hit=!0,r.stroke("#FF0000").strokeWeight(2).line(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2,this.y+this.grid.cellSize*t.y+this.grid.cellSize/2,h.x,h.y)}return}const o=this.enemies.find(h=>e.x>=h.x-12&&e.x<=h.x+12&&e.y>=h.y-12&&e.y<=h.y+12);if(o){const h=e.damage,l=o.health;e.damage-=l,o.hurt(h),e.hit=!0}})}),x.getInstance().getSetting("showEnemyPath")==="on"){r.stroke("#FF0000").strokeWeight(1).noFill();for(let t=0;t<this.path.length-1;t+=1){const[s,i]=this.path[t],[e,o]=this.path[t+1];r.line(this.x+s*this.grid.cellSize+this.grid.cellSize/2,this.y+i*this.grid.cellSize+this.grid.cellSize/2,this.x+e*this.grid.cellSize+this.grid.cellSize/2,this.y+o*this.grid.cellSize+this.grid.cellSize/2)}r.noStroke().strokeWeight(1)}}generateNewWave(){this.wave+=1;const t=Math.floor(this.wave*1.5)+10,s=Math.floor(this.wave*.4)+3;for(let i=0;i<s;i+=1)this.enemies.push(new _(t))}tryGenerateBullet(t,s){const i=this.enemies.find(h=>Math.abs(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2-h.x)<=s.range&&Math.abs(this.y+this.grid.cellSize*t.y+this.grid.cellSize/2-h.y)<=s.range);if(!i)return;const e=i.x-(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2),o=i.y-(this.y+this.grid.cellSize*t.y+this.grid.cellSize/2);return new O({x:this.x+this.grid.cellSize*t.x+this.grid.cellSize/2,y:this.y+this.grid.cellSize*t.y+this.grid.cellSize/2},{dx:e,dy:o},s.attackSpeed*5,s.attack,s instanceof I,s instanceof $)}addMoney(t){this.money+=t}checkInMap(t,s){return t>=this.x&&t<=this.x+this.grid.cols*this.grid.cellSize&&s>=this.y&&s<=this.y+this.grid.rows*this.grid.cellSize}getCellfromCoord(t,s){return{x:Math.floor((t-this.x)/this.grid.cellSize),y:Math.floor((s-this.y)/this.grid.cellSize)}}getGridArray(){const t=[];for(let s=0;s<this.grid.rows;s+=1){t[s]=[];for(let i=0;i<this.grid.cols;i+=1)t[s][i]=0}return this.towers.forEach(({coord:s})=>{t[s.y][s.x]=1}),t}checkCellValid(t){return this.grid.isValidCell(t)&&this.getGridArray()[t.y][t.x]===0&&!(t.x===0&&t.y===0)&&!(t.x===this.grid.rows-1&&t.y===this.grid.cols-1)}checkHasTower(t){return this.towers.some(({coord:s})=>s.x===t.x&&s.y===t.y)}tryPutTower(t,s,i){const e=this.getCellfromCoord(s,i);if(this.money<t.baseCost||!this.checkCellValid(e))return!1;const o=this.getGridArray();o[e.y][e.x]=1;const l=new P.AStarFinder({grid:{matrix:o},diagonalAllowed:!1,heuristic:"Manhattan",includeStartNode:!0,includeEndNode:!0}).findPath({x:0,y:0},{x:this.grid.rows-1,y:this.grid.cols-1});return l.length===0||l[l.length-1][0]!==this.grid.rows-1||l[l.length-1][1]!==this.grid.cols-1?!1:(this.path=l,this.money-=t.baseCost,this.towers.push({coord:e,tower:t,bullets:[]}),!0)}getTower(t){var s;return(s=this.towers.find(({coord:i})=>i.x===t.x&&i.y===t.y))==null?void 0:s.tower}tryUpgradeTower(t,s){const i=this.getCellfromCoord(t,s),e=this.getTower(i);return!e||this.money<e.upgradeCost?!1:(this.money-=e.upgradeCost,e.level+=1,!0)}trySellTower(t,s){const i=this.getCellfromCoord(t,s),e=this.getTower(i);if(!e)return!1;this.money+=e.totalCost*.8,this.towers=this.towers.filter(({coord:h})=>!(h.x===i.x&&h.y===i.y));const o=new P.AStarFinder({grid:{matrix:this.getGridArray()},diagonalAllowed:!1,allowPathAsCloseAsPossible:!0});return this.path=o.findPath({x:0,y:0},{x:this.grid.rows-1,y:this.grid.cols-1}),!0}}var R;(function(a){a[a.Blank=0]="Blank",a[a.Tower=1]="Tower",a[a.Sell=2]="Sell",a[a.Upgrade=3]="Upgrade",a[a.Error=4]="Error"})(R||(R={}));class J{constructor(){this.pointerState=0,this.cooldown=0}setTower(t){this.tower=t,this.pointerState=1,this.addCooldown()}setUpgrade(){this.pointerState=3,this.addCooldown()}setSell(){this.pointerState=2,this.addCooldown()}setBlank(){this.pointerState=0}setError(){this.pointerState=4}addCooldown(t=5){this.cooldown+=t}render(t,s){var e;this.cooldown=this.cooldown>0?this.cooldown-1:this.cooldown;const i=n.getCellfromCoord(r.mouseX,r.mouseY);switch(this.pointerState){case 1:n.grid.isValidCell(i)&&(n.checkCellValid(i)?r.fill("#57C3D1"):r.fill("#AE2E2E"),r.rect(n.x+n.grid.cellSize*i.x,n.y+n.grid.cellSize*i.y,n.grid.cellSize,n.grid.cellSize).noFill()),(e=this.tower)==null||e.draw(t,s,40);break;case 2:this.drawSell(t,s,i);break;case 3:this.drawUpgrade(t,s,i);break;case 4:r.stroke("#AE2E2E").strokeWeight(8).line(t-20,s-20,t+20,s+20).line(t+20,s-20,t-20,s+20).strokeWeight(1).noStroke();break;case 0:this.drawBlank(t,s,i);break}}drawUpgrade(t,s,i){n.grid.isValidCell(i)&&(n.checkHasTower(i)?r.fill("#57C3D1"):r.fill("#AE2E2E"),r.rect(n.x+n.grid.cellSize*i.x,n.y+n.grid.cellSize*i.y,n.grid.cellSize,n.grid.cellSize).noFill()),r.fill("#66CCFF").stroke("#66CCFF").strokeWeight(1).triangle(t-10,s+10,t+10,s+10,t,s-10).noFill().noStroke();const e=n.getTower(i);!e||(new d(e.info.split("").filter((o,h)=>h<40).join(""),1560,350,300,30).draw(),new d(e.info.split("").filter((o,h)=>h>=40).join(""),1560,380,300,30).draw(),new d(`Attack: ${e.attack} + ${e.attackPerLevel}`,1560,410,300,30).draw(),new d(`Attack Speed: ${e.attackSpeed} + ${e.attackSpeedPerLevel}`,1560,440,300,30).draw(),new d(`Range: ${e.range} + ${e.rangePerLevel}`,1560,470,300,30).draw(),new d(`Cost: ${e.upgradeCost}`,1560,500,300,30).draw())}drawSell(t,s,i){n.grid.isValidCell(i)&&(n.checkHasTower(i)?r.fill("#57C3D1"):r.fill("#AE2E2E"),r.rect(n.x+n.grid.cellSize*i.x,n.y+n.grid.cellSize*i.y,n.grid.cellSize,n.grid.cellSize).noFill()),r.fill("#DD6699").stroke("#DD6699").strokeWeight(1).rect(t-10,s-10,20,20).line(t-20,s-20,t+20,s+20).line(t-20,s+20,t+20,s-20).noFill().noStroke();const e=n.getTower(i);!e||new d(`Sell Price: ${e.totalCost*.8}`,1560,350,300,30).draw()}drawBlank(t,s,i){const e=n.towers.find(({coord:h})=>h.x===i.x&&h.y===i.y);e&&r.fill(242,224,68,130).circle(n.x+n.grid.cellSize*i.x+n.grid.cellSize/2,n.y+n.grid.cellSize*i.y+n.grid.cellSize/2,e.tower.range*2);const o=n.getTower(i);!o||(new d(o.info.split("").filter((h,l)=>l<40).join(""),1560,350,300,30).draw(),new d(o.info.split("").filter((h,l)=>l>=40).join(""),1560,380,300,30).draw(),new d(`Attack: ${o.attack}`,1560,410,300,30).draw(),new d(`Attack Speed: ${o.attackSpeed}`,1560,440,300,30).draw(),new d(`Range: ${o.range}`,1560,470,300,30).draw(),new d(`Invested: ${o.totalCost}`,1560,500,300,30).draw())}onClick(t,s){if(!(this.cooldown>0)){switch(this.pointerState){case 1:if(!this.tower)break;n.tryPutTower(this.tower,t,s)?this.tower=void 0:this.setError();break;case 2:n.trySellTower(t,s)?this.setBlank():this.setError();break;case 3:n.tryUpgradeTower(t,s)?this.setBlank():this.setError();break}setTimeout(()=>{this.setBlank()},200)}}}const b=new J;class F{constructor(){this.level=0,this.baseAttack=1,this.attackPerLevel=1.5,this.baseAttackSpeed=1,this.attackSpeedPerLevel=.4,this.bulletSpeed=2,this.baseCost=100,this.CostAmplifier=1.5,this.baseRange=100,this.rangePerLevel=100,this.info="A basic tower with low attack and cost."}draw(t,s,i){i*=.8,r.fill("#005408").circle(t,s,i)}get attack(){return this.baseAttack+this.level*this.attackPerLevel}get attackSpeed(){return this.baseAttackSpeed+this.level*this.attackSpeedPerLevel}get range(){return this.baseRange+this.level*this.rangePerLevel}get upgradeCost(){return this.baseCost*this.CostAmplifier**(this.level+1)}get totalCost(){let t=0;for(let s=0;s<=this.level;s+=1)t+=this.baseCost*this.CostAmplifier**s;return t}copy(){const t=new F;return t.level=this.level,t}}class T{constructor(){this.level=0,this.baseAttack=5,this.attackPerLevel=7.5,this.baseAttackSpeed=.3,this.attackSpeedPerLevel=.1,this.bulletSpeed=1.5,this.baseCost=230,this.CostAmplifier=1.8,this.baseRange=80,this.rangePerLevel=80,this.info="A strong tower with high attack but low speed."}draw(t,s,i){r.fill("#1C53E1").circle(t,s,i)}get attack(){return this.baseAttack+this.level*this.attackPerLevel}get attackSpeed(){return this.baseAttackSpeed+this.level*this.attackSpeedPerLevel}get range(){return this.baseRange+this.level*this.rangePerLevel}get upgradeCost(){return this.baseCost*this.CostAmplifier**(this.level+1)}get totalCost(){return this.baseCost*this.CostAmplifier**this.level}copy(){const t=new T;return t.level=this.level,t}}class D{constructor(t,s,i,e,o,h,l,c){this.id=t,this.x=s,this.y=i,this.width=e,this.height=o,this.visible=h,this.parent=l,this.tower=c,this.towerInfo=[],this.mouseHoverHandler=[],this.mouseInHandler=[],this.mouseOutHandler=[],this.mouseHovering=!1,this.mouseDownHandler=[],this.mouseUpHandler=[],this.onClickedHandler=[],this.towerInfo.push(new d(c.info.split("").filter((w,u)=>u<40).join(""),1560,350,300,30,this)),this.towerInfo.push(new d(c.info.split("").filter((w,u)=>u>=40).join(""),1560,380,300,30,this)),this.towerInfo.push(new d(`Attack: ${c.baseAttack}`,1560,410,300,30,this)),this.towerInfo.push(new d(`Attack Speed: ${c.baseAttackSpeed}`,1560,440,300,30,this)),this.towerInfo.push(new d(`Cost: ${c.baseCost}`,1560,470,300,30,this))}draw(){this.mouseHovering?(this.towerInfo.forEach(t=>t.draw()),r.stroke("#AACCFF")):r.stroke(0),r.strokeWeight(6).fill(255).rect(this.x+3,this.y+3,this.width-3,this.height-3).strokeWeight(1).noStroke(),this.tower.draw((this.x*2+this.width)/2,(this.y*2+this.height)/2,180)}onHover(){}onMouseIn(){this.mouseHovering=!0}onMouseOut(){this.mouseHovering=!1}mouseDown(){}mouseUp(){}onClicked(){b.setTower(this.tower.copy())}}class K{constructor(t){this.parent=t,this.id="tower-selection-menu",this.x=0,this.y=0,this.width=500,this.height=1080,this.visible=!0,this.towerSlots=new Array,this.mouseDownHandler=[],this.mouseUpHandler=[],this.onClickedHandler=[],this.mouseHoverHandler=[],this.mouseInHandler=[],this.mouseOutHandler=[],this.mouseHovering=!1,this.towerSlots.push(new D("t1-tower-slot",0,0,300,270,!0,this,new F)),this.towerSlots.push(new D("t2-tower-slot",0,270,300,270,!0,this,new T)),this.towerSlots.push(new D("t3-tower-slot",0,540,300,270,!0,this,new I)),this.towerSlots.push(new D("t4-tower-slot",0,810,300,270,!0,this,new $))}draw(){this.towerSlots.forEach(t=>t.draw())}onClicked(t,s){var i;(i=this.towerSlots.filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.onClicked()}mouseDown(t,s){var i;(i=this.towerSlots.filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.mouseDown()}mouseUp(t,s){var i;(i=this.towerSlots.filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.mouseUp()}onHover(t,s){var i;(i=this.towerSlots.filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.onHover(),this.towerSlots.forEach(e=>{t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height?e.mouseHovering||e.onMouseIn():e.mouseHovering&&e.onMouseOut()})}onMouseIn(){}onMouseOut(){}}let n;class H extends A{constructor(){super();this.waveInfo=new d("Wave: 0",1560,40,150,30,this),this.moneyInfo=new d("Money: 0",1560,80,150,30,this),this.lifeInfo=new d("Life: 100",1560,120,150,30,this),this.id="game-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[],H.instance=this}init(){n=new q(this),this.components.push(n),this.components.push(new K(this)),this.components.push(this.waveInfo),this.components.push(this.moneyInfo),this.components.push(this.lifeInfo);const t=new v(1560,160,150,60,"Upgrade",this,"#66CCFF","#77CCFF","#88CCFF");this.components.push(t),t.onClickedHandler.push(()=>{b.setUpgrade()});const s=new v(1560,250,150,60,"Sell",this,"#DD6699","#EE6699","#FF6699");this.components.push(s),s.onClickedHandler.push(()=>{b.setSell()});const i=new v(1560,900,150,60,"Exit",this,"#FFCC66","#FFDD66","#FFEE66");this.components.push(i),i.onClickedHandler.push(()=>{this.components=[],k.switchScreen(M.instance)})}draw(){!this.visible||(r.background("#D9D9D9"),this.components.forEach(t=>{t.draw()}),this.waveInfo.updateText(`Wave: ${n.wave}`),this.moneyInfo.updateText(`Money: ${n.money}`),this.lifeInfo.updateText(`Life: ${Math.round(n.life)}`),b.render(r.mouseX,r.mouseY))}mouseClicked(t,s){super.mouseClicked(t,s),b.onClick(t,s)}}let W=!1;function Q(){if(W)return;x.getInstance().loadSettingsFromCookies();const a=new M,t=new z,s=new E,i=new H;k.registerScreen(a),k.registerScreen(t),k.registerScreen(s),k.registerScreen(i),k.showScreen(a),W=!0}var tt=`#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
`;let f,g,r;new X(a=>{r=a,r.setup=function(){r.createCanvas(1920,1080),r.rectMode(r.CORNER).noFill().frameRate(60),f=r.width,g=r.height,Q()},r.draw=function(){r.background(0),k.draw()},r.mousePressed=()=>{var t;(t=k.getCurrentScreen())==null||t.mouseDown(r.mouseX,r.mouseY)},r.mouseReleased=()=>{var t;(t=k.getCurrentScreen())==null||t.mouseUp(r.mouseX,r.mouseY)},r.mouseClicked=()=>{var t;(t=k.getCurrentScreen())==null||t.mouseClicked(r.mouseX,r.mouseY)},r.mouseMoved=()=>{var t;(t=k.getCurrentScreen())==null||t.mouseMoved(r.mouseX,r.mouseY)},r.windowResized=()=>{}},document.getElementById("app"));
