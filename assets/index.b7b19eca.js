import{a as F,p as X}from"./vendor.5f31fa66.js";class w{static registerScreen(t){this.screens.set(t.id,t)}static getScreen(t){return this.screens.get(t)}static showScreen(t){this.currentScreen.push(t)}static switchScreen(t){this.currentScreen=[t]}static removeScreen(){this.currentScreen.pop()}static getCurrentScreen(){return this.currentScreen[this.currentScreen.length-1]}static draw(){this.currentScreen.forEach(t=>{t.draw()})}}w.screens=new Map,w.currentScreen=new Array;class O{constructor(t,s,i,e,o,h="#ffffff",a="#dddddd",u="#aaaaaa",m,g=!1,k){var C,S,y,p;this.mouseDownHandler=[],this.mouseUpHandler=[],this.mouseHoverHandler=[],this.mouseInHandler=[],this.mouseOutHandler=[],this.onClickedHandler=[],this.mouseHovering=!1,this.id=(C=k!=null?k:`${o==null?void 0:o.id}-button-${t}-${s}`)!=null?C:`bare-button-${t}-${s}`,this.x=g?(S=o==null?void 0:o.x)!=null?S:0+t:t,this.y=g?(y=o==null?void 0:o.y)!=null?y:0+s:s,this.width=i,this.height=e,this.defaultColor=h,this.renderColor=h,this.hoverColor=a,this.clickColor=u,this.visible=(p=m!=null?m:o==null?void 0:o.visible)!=null?p:!0,this.parent=o!=null?o:this}draw(){!this.visible||r.fill(this.renderColor).rect(this.x,this.y,this.width,this.height,5)}mouseDown(){this.renderColor=this.clickColor,this.mouseDownHandler.forEach(t=>t())}mouseUp(){this.renderColor=this.defaultColor,this.mouseUpHandler.forEach(t=>t())}onClicked(){this.onClickedHandler.forEach(t=>t())}onHover(){this.renderColor=this.hoverColor,this.mouseHoverHandler.forEach(t=>t())}onMouseIn(){this.mouseHovering=!0,this.mouseInHandler.forEach(t=>t())}onMouseOut(){this.renderColor=this.defaultColor,this.mouseHovering=!1,this.mouseOutHandler.forEach(t=>t())}}class f{constructor(t,s,i,e,o,h,a="#000000",u="#000000",m="#000000",g,k=!1,C){var S,y,p,U;this.mouseDownHandler=[],this.mouseUpHandler=[],this.mouseHoverHandler=[],this.mouseInHandler=[],this.mouseOutHandler=[],this.onClickedHandler=[],this.mouseHovering=!1,this.text=t,this.id=(S=C!=null?C:`${h==null?void 0:h.id}-text-${s}-${i}-${t}`)!=null?S:`bare-text-${s}-${i}-${t}`,this.x=k?(y=h==null?void 0:h.x)!=null?y:0+s:s,this.y=k?(p=h==null?void 0:h.y)!=null?p:0+i:i,this.width=e,this.height=o,this.defaultColor=a,this.renderColor=a,this.hoverColor=u,this.clickColor=m,this.visible=(U=g!=null?g:h==null?void 0:h.visible)!=null?U:!0,this.parent=h!=null?h:this}draw(){if(!this.visible)return;const t=Math.min(this.width/4,this.height/2);r.fill(this.renderColor).textSize(t).textAlign(r.CENTER,r.CENTER).text(this.text,this.x,this.y,this.width,this.height)}updateText(t){this.text=t}mouseDown(){this.renderColor=this.clickColor,this.mouseDownHandler.forEach(t=>t())}mouseUp(){this.renderColor=this.defaultColor,this.mouseUpHandler.forEach(t=>t())}onClicked(){this.onClickedHandler.forEach(t=>t())}onHover(){this.mouseHoverHandler.forEach(t=>t())}onMouseIn(){this.mouseHovering=!0,this.renderColor=this.hoverColor,this.mouseInHandler.forEach(t=>t())}onMouseOut(){this.renderColor=this.defaultColor,this.mouseHovering=!1,this.mouseOutHandler.forEach(t=>t())}}class v extends O{constructor(t,s,i,e,o,h,a="#ffffff",u="#dddddd",m="#aaaaaa",g,k=!1,C){super(t,s,i,e,h,a,u,m,g,k,C);const S=this.width*.1,y=this.height*.08;this.text=new f(o,this.x+S,this.y+y,this.width-S*2,this.height-y*2,this)}draw(){!this.visible||(super.draw(),this.text.draw())}}class b{constructor(){this.id="base-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=new Array,this.init()}init(){throw new Error("Method not implemented.")}draw(){!this.visible||this.components.forEach(t=>{t.draw()})}mouseClicked(t,s){var i;(i=this.components.filter(e=>"onClicked"in e).filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.onClicked(t,s)}mouseDown(t,s){var i;(i=this.components.filter(e=>"mouseDown"in e).filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.mouseDown(t,s)}mouseUp(t,s){var i;(i=this.components.filter(e=>"mouseUp"in e).filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.mouseUp(t,s)}mouseMoved(t,s){var i;(i=this.components.filter(e=>"onHover"in e).filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.onHover(t,s),this.components.filter(e=>"onHover"in e).forEach(e=>{t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height?e.mouseHovering||e.onMouseIn(t,s):e.mouseHovering&&e.onMouseOut(t,s)})}}class x{constructor(){this.settings={}}static getInstance(){return x.instance||(x.instance=new x),x.instance}getSetting(t){return this.settings[t]}setSetting(t,s){this.settings[t]=s,this.saveSettingsToCookies()}saveSettingsToCookies(){const t=JSON.stringify(this.settings);document.cookie=`settings=${t}`}loadSettingsFromCookies(){const s=document.cookie.split(";").find(i=>i.trim().startsWith("settings="));if(s){const i=s.split("=")[1];this.settings=JSON.parse(i)}}}class N{constructor(t,s,i,e,o=!1,h=!1){this.start=t,this.direction=s,this.speed=i,this.damage=e,this.pass=o,this.ray=h,this.hit=!1,this.x=t.x,this.y=t.y;const a=Math.sqrt(s.dx**2+s.dy**2);this.direction.dx=s.dx/a*i,this.direction.dy=s.dy/a*i}draw(){if(this.x+=this.direction.dx,this.y+=this.direction.dy,this.ray){const t=this.start.x+this.direction.dx*1e3,s=this.start.y+this.direction.dy*1e3,i=Y({p1:this.start,p2:{x:t,y:s}},{minX:540,minY:40,maxX:1540,maxY:1040});if(!i)return;r.stroke("#000000").line(this.start.x,this.start.y,i.x,i==null?void 0:i.y).noStroke(),this.hit=!0}else r.fill("#000000").circle(this.x,this.y,6)}shouldRemove(){return n.checkInMap(this.x,this.y)?this.pass?this.damage<=0:this.hit:!0}}function Y(d,t){const s=d.p1.x,i=d.p1.y,e=d.p2.x,o=d.p2.y;if(s===e){if(s<t.minX||s>t.maxX)return null;const u=Math.max(t.minY,Math.min(t.maxY,Math.max(i,o)));return{x:s,y:u}}const h=(o-i)/(e-s),a=i-h*s;if(h!==0){const u=Math.max(t.minX,Math.min(t.maxX,(t.minY-a)/h)),m=Math.max(t.minX,Math.min(t.maxX,(t.maxY-a)/h));if(u>=s&&u<=e||m>=s&&m<=e){const g=e>s?u:m,k=h*g+a;return{x:g,y:k}}}return null}class G{constructor(t){this.difficulty=t,this.x=565,this.y=65,this.speed=1,this.health=100,this.maxHealth=100,this.armor=0,this.attack=0,this.color=[Math.floor(Math.random()*255),Math.floor(Math.random()*255),Math.floor(Math.random()*255)],this.diameter=Math.random()*10+5,this.speed=(1+Math.random()*t*.3)/3,this.speed>10&&(this.speed=10),this.health=-1+Math.random()*t*.05,this.armor=Math.random()*t*.02,this.attack=Math.random()*t*.01}hurt(t){this.health-=t-this.armor,this.health<=0&&this.death()}death(){n.addMoney(Math.floor(5+Math.random()*this.difficulty*10)),n.enemies.splice(n.enemies.indexOf(this),1)}doAttack(){n.life-=this.attack,console.log(this),this.death(),n.life<=0&&w.switchScreen(M.instance)}draw(){if(Number.isNaN(this.x)||Number.isNaN(this.y))return;r.fill(this.color).circle(this.x,this.y,this.diameter);const t=this.getVelocity(n.path);this.x+=t.dx,this.y+=t.dy}getVelocity(t){const s=n.getCellfromCoord(this.x,this.y);if(s.y===t[t.length-1][0]&&s.x===t[t.length-1][1])return this.doAttack(),{dx:0,dy:0};const i=t.findIndex(k=>k[1]===s.y&&k[0]===s.x)+1;if(i===0){const k=t.reduce((C,S)=>{const y=Math.abs(C[1]-s.y)+Math.abs(C[0]-s.x),p=Math.abs(S[1]-s.y)+Math.abs(S[0]-s.x);return y<p?C:S});return this.x=565+k[0]*n.grid.cellSize,this.y=65+k[1]*n.grid.cellSize,{dx:0,dy:0}}const e=t[i];if(!e)return this.doAttack(),{dx:0,dy:0};const o={x:565+e[0]*n.grid.cellSize,y:65+e[1]*n.grid.cellSize},h=o.x-this.x,a=o.y-this.y,u=Math.sqrt(h*h+a*a),m=h/u*this.speed,g=a/u*this.speed;return{dx:m,dy:g}}}class E{constructor(){this.level=0,this.baseAttack=3,this.attackPerLevel=5,this.baseAttackSpeed=.5,this.attackSpeedPerLevel=.3,this.bulletSpeed=2,this.baseCost=320,this.CostAmplifier=2,this.baseRange=150,this.rangePerLevel=100,this.info="A tower with a moderate attack but can go through enemies."}draw(t,s,i){i*=.5,r.fill("#D522A3").circle(t,s,i)}get attack(){return this.baseAttack+this.level*this.attackPerLevel}get attackSpeed(){return this.baseAttackSpeed+this.level*this.attackSpeedPerLevel}get range(){return this.baseRange+this.level*this.rangePerLevel}get upgradeCost(){return this.baseCost*this.CostAmplifier**(this.level+1)}get totalCost(){return this.baseCost*this.CostAmplifier**this.level}copy(){const t=new E;return t.level=this.level,t}}class I{constructor(){this.level=0,this.baseAttack=1,this.attackPerLevel=1,this.baseAttackSpeed=6,this.attackSpeedPerLevel=4,this.bulletSpeed=10,this.baseCost=600,this.CostAmplifier=2,this.baseRange=300,this.rangePerLevel=200,this.info="A lazer tower with super high attack speed."}draw(t,s,i){i*=.4,r.fill("#BC0AFB").circle(t,s,i)}get attack(){return this.baseAttack+this.level*this.attackPerLevel}get attackSpeed(){return this.baseAttackSpeed+this.level*this.attackSpeedPerLevel}get range(){return this.baseRange+this.level*this.rangePerLevel}get upgradeCost(){return this.baseCost*this.CostAmplifier**(this.level+1)}get totalCost(){return this.baseCost*this.CostAmplifier**this.level}copy(){const t=new I;return t.level=this.level,t}}class B{constructor(t,s,i){this.cellSize=i,this.rows=t,this.cols=s}isValidCell(t){return t.x>=0&&t.x<this.cols&&t.y>=0&&t.y<this.rows}}class V{constructor(t){this.parent=t,this.id="game-map",this.x=540,this.y=40,this.width=-1,this.height=-1,this.visible=!0,this.grid=new B(20,20,50),this.towers=[],this.enemies=[],this.bullets=[],this.money=200,this.life=100,this.wave=0,this.path=[],this.counter=0,this.refresh()}refresh(){this.towers=[],this.enemies=[],this.bullets=[],this.money=600,this.life=100,this.wave=0,this.grid=new B(20,20,50);const t=new F.AStarFinder({grid:{matrix:this.getGridArray()},diagonalAllowed:!1,allowPathAsCloseAsPossible:!0});this.path=t.findPath({x:0,y:0},{x:this.grid.rows-1,y:this.grid.cols-1})}draw(){this.counter%60==0&&(this.money+=1),this.counter%600==0&&(this.life+=10,this.generateNewWave()),this.counter>=72e3&&(this.counter=0),this.counter+=1,r.stroke(0);for(let t=this.x;t<=this.x+this.grid.cols*this.grid.cellSize;t+=this.grid.cellSize)r.line(t,this.y,t,this.y+this.grid.cellSize*this.grid.rows);for(let t=this.y;t<=this.y+this.grid.rows*this.grid.cellSize;t+=this.grid.cellSize)r.line(this.x,t,this.x+this.grid.cellSize*this.grid.cols,t);if(r.noStroke(),r.fill("#FA6A6A").circle(this.x+25,this.y+25,40),r.fill("#07D270").circle(this.x+975,this.y+975,40),this.enemies.forEach(t=>{t.draw()}),this.towers.forEach(({coord:t,tower:s,bullets:i})=>{if(s.draw(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2,this.y+this.grid.cellSize*t.y+this.grid.cellSize/2,40),this.counter%Math.floor(60/s.attackSpeed)==0){const e=this.tryGenerateBullet(t,s);e&&(i==null||i.push(e))}i==null||i.forEach(e=>{e.draw()}),i.splice(0,i.length,...i.filter(e=>e.shouldRemove()===!1)),i.forEach(e=>{if(e.ray){const h=this.enemies.find(a=>Math.abs(a.x-(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2))<=s.range&&Math.abs(a.y-(this.y+this.grid.cellSize*t.y+this.grid.cellSize/2))<=s.range);if(h){const a=e.damage,u=h.health;e.damage-=u,h.hurt(a),e.hit=!0,r.stroke("#FF0000").strokeWeight(2).line(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2,this.y+this.grid.cellSize*t.y+this.grid.cellSize/2,h.x,h.y)}return}const o=this.enemies.find(h=>e.x>=h.x-12&&e.x<=h.x+12&&e.y>=h.y-12&&e.y<=h.y+12);if(o){const h=e.damage,a=o.health;e.damage-=a,o.hurt(h),e.hit=!0}})}),x.getInstance().getSetting("showEnemyPath")==="on"){r.stroke("#FF0000").strokeWeight(1).noFill();for(let t=0;t<this.path.length-1;t+=1){const[s,i]=this.path[t],[e,o]=this.path[t+1];r.line(this.x+s*this.grid.cellSize+this.grid.cellSize/2,this.y+i*this.grid.cellSize+this.grid.cellSize/2,this.x+e*this.grid.cellSize+this.grid.cellSize/2,this.y+o*this.grid.cellSize+this.grid.cellSize/2)}r.noStroke().strokeWeight(1)}}generateNewWave(){this.wave+=1;const t=Math.floor(this.wave*1.5)+10,s=Math.floor(this.wave*.4)+3;for(let i=0;i<s;i+=1)this.enemies.push(new G(t))}tryGenerateBullet(t,s){const i=this.enemies.find(h=>Math.abs(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2-h.x)<=s.range&&Math.abs(this.y+this.grid.cellSize*t.y+this.grid.cellSize/2-h.y)<=s.range);if(!i)return;const e=i.x-(this.x+this.grid.cellSize*t.x+this.grid.cellSize/2),o=i.y-(this.y+this.grid.cellSize*t.y+this.grid.cellSize/2);return new N({x:this.x+this.grid.cellSize*t.x+this.grid.cellSize/2,y:this.y+this.grid.cellSize*t.y+this.grid.cellSize/2},{dx:e,dy:o},s.attackSpeed*5,s.attack,s instanceof E,s instanceof I)}addMoney(t){this.money+=t}checkInMap(t,s){return t>=this.x&&t<=this.x+this.grid.cols*this.grid.cellSize&&s>=this.y&&s<=this.y+this.grid.rows*this.grid.cellSize}getCellfromCoord(t,s){return{x:Math.floor((t-this.x)/this.grid.cellSize),y:Math.floor((s-this.y)/this.grid.cellSize)}}getGridArray(){const t=[];for(let s=0;s<this.grid.rows;s+=1){t[s]=[];for(let i=0;i<this.grid.cols;i+=1)t[s][i]=0}return this.towers.forEach(({coord:s})=>{t[s.y][s.x]=1}),t}checkCellValid(t){return this.grid.isValidCell(t)&&this.getGridArray()[t.y][t.x]===0&&!(t.x===0&&t.y===0)&&!(t.x===this.grid.rows-1&&t.y===this.grid.cols-1)}checkHasTower(t){return this.towers.some(({coord:s})=>s.x===t.x&&s.y===t.y)}tryPutTower(t,s,i){const e=this.getCellfromCoord(s,i);if(this.money<t.baseCost||!this.checkCellValid(e))return!1;const o=this.getGridArray();o[e.y][e.x]=1;const a=new F.AStarFinder({grid:{matrix:o},diagonalAllowed:!1,heuristic:"Manhattan",includeStartNode:!0,includeEndNode:!0}).findPath({x:0,y:0},{x:this.grid.rows-1,y:this.grid.cols-1});return a.length===0||a[a.length-1][0]!==this.grid.rows-1||a[a.length-1][1]!==this.grid.cols-1?!1:(this.path=a,this.money-=t.baseCost,this.towers.push({coord:e,tower:t,bullets:[]}),!0)}getTower(t){var s;return(s=this.towers.find(({coord:i})=>i.x===t.x&&i.y===t.y))==null?void 0:s.tower}tryUpgradeTower(t,s){const i=this.getCellfromCoord(t,s),e=this.getTower(i);return!e||this.money<e.upgradeCost?!1:(this.money-=e.upgradeCost,e.level+=1,!0)}trySellTower(t,s){const i=this.getCellfromCoord(t,s),e=this.getTower(i);if(!e)return!1;this.money+=e.totalCost*.8,this.towers=this.towers.filter(({coord:h})=>!(h.x===i.x&&h.y===i.y));const o=new F.AStarFinder({grid:{matrix:this.getGridArray()},diagonalAllowed:!1,allowPathAsCloseAsPossible:!0});return this.path=o.findPath({x:0,y:0},{x:this.grid.rows-1,y:this.grid.cols-1}),!0}}var _;(function(d){d[d.Blank=0]="Blank",d[d.Tower=1]="Tower",d[d.Sell=2]="Sell",d[d.Upgrade=3]="Upgrade",d[d.Error=4]="Error"})(_||(_={}));class j{constructor(){this.pointerState=0,this.cooldown=0}setTower(t){this.tower=t,this.pointerState=1,this.addCooldown()}setUpgrade(){this.pointerState=3,this.addCooldown()}setSell(){this.pointerState=2,this.addCooldown()}setBlank(){this.pointerState=0}setError(){this.pointerState=4}addCooldown(t=5){this.cooldown+=t}render(t,s){var e;this.cooldown=this.cooldown>0?this.cooldown-1:this.cooldown;const i=n.getCellfromCoord(r.mouseX,r.mouseY);switch(this.pointerState){case 1:n.grid.isValidCell(i)&&(n.checkCellValid(i)?r.fill("#57C3D1"):r.fill("#AE2E2E"),r.rect(n.x+n.grid.cellSize*i.x,n.y+n.grid.cellSize*i.y,n.grid.cellSize,n.grid.cellSize).noFill()),(e=this.tower)==null||e.draw(t,s,40);break;case 2:this.drawSell(t,s,i);break;case 3:this.drawUpgrade(t,s,i);break;case 4:r.stroke("#AE2E2E").strokeWeight(8).line(t-20,s-20,t+20,s+20).line(t+20,s-20,t-20,s+20).strokeWeight(1).noStroke();break;case 0:this.drawBlank(t,s,i);break}}drawUpgrade(t,s,i){n.grid.isValidCell(i)&&(n.checkHasTower(i)?r.fill("#57C3D1"):r.fill("#AE2E2E"),r.rect(n.x+n.grid.cellSize*i.x,n.y+n.grid.cellSize*i.y,n.grid.cellSize,n.grid.cellSize).noFill()),r.fill("#66CCFF").stroke("#66CCFF").strokeWeight(1).triangle(t-10,s+10,t+10,s+10,t,s-10).noFill().noStroke();const e=n.getTower(i);!e||(new f(e.info.split("").filter((o,h)=>h<40).join(""),1560,350,300,30).draw(),new f(e.info.split("").filter((o,h)=>h>=40).join(""),1560,380,300,30).draw(),new f(`Attack: ${e.attack} + ${e.attackPerLevel}`,1560,410,300,30).draw(),new f(`Attack Speed: ${e.attackSpeed} + ${e.attackSpeedPerLevel}`,1560,440,300,30).draw(),new f(`Range: ${e.range} + ${e.rangePerLevel}`,1560,470,300,30).draw(),new f(`Cost: ${e.upgradeCost}`,1560,500,300,30).draw())}drawSell(t,s,i){n.grid.isValidCell(i)&&(n.checkHasTower(i)?r.fill("#57C3D1"):r.fill("#AE2E2E"),r.rect(n.x+n.grid.cellSize*i.x,n.y+n.grid.cellSize*i.y,n.grid.cellSize,n.grid.cellSize).noFill()),r.fill("#DD6699").stroke("#DD6699").strokeWeight(1).rect(t-10,s-10,20,20).line(t-20,s-20,t+20,s+20).line(t-20,s+20,t+20,s-20).noFill().noStroke();const e=n.getTower(i);!e||new f(`Sell Price: ${e.totalCost*.8}`,1560,350,300,30).draw()}drawBlank(t,s,i){const e=n.towers.find(({coord:h})=>h.x===i.x&&h.y===i.y);e&&r.fill(242,224,68,130).circle(n.x+n.grid.cellSize*i.x+n.grid.cellSize/2,n.y+n.grid.cellSize*i.y+n.grid.cellSize/2,e.tower.range*2);const o=n.getTower(i);!o||(new f(o.info.split("").filter((h,a)=>a<40).join(""),1560,350,300,30).draw(),new f(o.info.split("").filter((h,a)=>a>=40).join(""),1560,380,300,30).draw(),new f(`Attack: ${o.attack}`,1560,410,300,30).draw(),new f(`Attack Speed: ${o.attackSpeed}`,1560,440,300,30).draw(),new f(`Range: ${o.range}`,1560,470,300,30).draw(),new f(`Invested: ${o.totalCost}`,1560,500,300,30).draw())}onClick(t,s){if(!(this.cooldown>0)){switch(this.pointerState){case 1:if(!this.tower)break;n.tryPutTower(this.tower,t,s)?this.tower=void 0:this.setError();break;case 2:n.trySellTower(t,s)?this.setBlank():this.setError();break;case 3:n.tryUpgradeTower(t,s)?this.setBlank():this.setError();break}setTimeout(()=>{this.setBlank()},200)}}}const H=new j;class T{constructor(){this.level=0,this.baseAttack=1,this.attackPerLevel=1.5,this.baseAttackSpeed=1,this.attackSpeedPerLevel=.4,this.bulletSpeed=2,this.baseCost=100,this.CostAmplifier=1.5,this.baseRange=100,this.rangePerLevel=100,this.info="A basic tower with low attack and cost."}draw(t,s,i){i*=.8,r.fill("#005408").circle(t,s,i)}get attack(){return this.baseAttack+this.level*this.attackPerLevel}get attackSpeed(){return this.baseAttackSpeed+this.level*this.attackSpeedPerLevel}get range(){return this.baseRange+this.level*this.rangePerLevel}get upgradeCost(){return this.baseCost*this.CostAmplifier**(this.level+1)}get totalCost(){let t=0;for(let s=0;s<=this.level;s+=1)t+=this.baseCost*this.CostAmplifier**s;return t}copy(){const t=new T;return t.level=this.level,t}}class L{constructor(){this.level=0,this.baseAttack=5,this.attackPerLevel=7.5,this.baseAttackSpeed=.3,this.attackSpeedPerLevel=.1,this.bulletSpeed=1.5,this.baseCost=230,this.CostAmplifier=1.8,this.baseRange=80,this.rangePerLevel=80,this.info="A strong tower with high attack but low speed."}draw(t,s,i){r.fill("#1C53E1").circle(t,s,i)}get attack(){return this.baseAttack+this.level*this.attackPerLevel}get attackSpeed(){return this.baseAttackSpeed+this.level*this.attackSpeedPerLevel}get range(){return this.baseRange+this.level*this.rangePerLevel}get upgradeCost(){return this.baseCost*this.CostAmplifier**(this.level+1)}get totalCost(){return this.baseCost*this.CostAmplifier**this.level}copy(){const t=new L;return t.level=this.level,t}}class D{constructor(t,s,i,e,o,h,a,u){this.id=t,this.x=s,this.y=i,this.width=e,this.height=o,this.visible=h,this.parent=a,this.tower=u,this.towerInfo=[],this.mouseHoverHandler=[],this.mouseInHandler=[],this.mouseOutHandler=[],this.mouseHovering=!1,this.mouseDownHandler=[],this.mouseUpHandler=[],this.onClickedHandler=[],this.towerInfo.push(new f(u.info.split("").filter((m,g)=>g<40).join(""),1560,350,300,30,this)),this.towerInfo.push(new f(u.info.split("").filter((m,g)=>g>=40).join(""),1560,380,300,30,this)),this.towerInfo.push(new f(`Attack: ${u.baseAttack}`,1560,410,300,30,this)),this.towerInfo.push(new f(`Attack Speed: ${u.baseAttackSpeed}`,1560,440,300,30,this)),this.towerInfo.push(new f(`Cost: ${u.baseCost}`,1560,470,300,30,this))}draw(){this.mouseHovering?(this.towerInfo.forEach(t=>t.draw()),r.stroke("#AACCFF")):r.stroke(0),r.strokeWeight(6).fill(255).rect(this.x+3,this.y+3,this.width-3,this.height-3).strokeWeight(1).noStroke(),this.tower.draw((this.x*2+this.width)/2,(this.y*2+this.height)/2,180)}onHover(){}onMouseIn(){this.mouseHovering=!0}onMouseOut(){this.mouseHovering=!1}mouseDown(){}mouseUp(){}onClicked(){H.setTower(this.tower.copy())}}class q{constructor(t){this.parent=t,this.id="tower-selection-menu",this.x=0,this.y=0,this.width=500,this.height=1080,this.visible=!0,this.towerSlots=new Array,this.mouseDownHandler=[],this.mouseUpHandler=[],this.onClickedHandler=[],this.mouseHoverHandler=[],this.mouseInHandler=[],this.mouseOutHandler=[],this.mouseHovering=!1,this.towerSlots.push(new D("t1-tower-slot",0,0,300,270,!0,this,new T)),this.towerSlots.push(new D("t2-tower-slot",0,270,300,270,!0,this,new L)),this.towerSlots.push(new D("t3-tower-slot",0,540,300,270,!0,this,new E)),this.towerSlots.push(new D("t4-tower-slot",0,810,300,270,!0,this,new I))}draw(){this.towerSlots.forEach(t=>t.draw())}onClicked(t,s){var i;(i=this.towerSlots.filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.onClicked()}mouseDown(t,s){var i;(i=this.towerSlots.filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.mouseDown()}mouseUp(t,s){var i;(i=this.towerSlots.filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.mouseUp()}onHover(t,s){var i;(i=this.towerSlots.filter(e=>t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height).slice(-1)[0])==null||i.onHover(),this.towerSlots.forEach(e=>{t>e.x&&t<e.x+e.width&&s>e.y&&s<e.y+e.height?e.mouseHovering||e.onMouseIn():e.mouseHovering&&e.onMouseOut()})}onMouseIn(){}onMouseOut(){}}let n;class A extends b{constructor(){super();this.waveInfo=new f("Wave: 0",1560,40,150,30,this),this.moneyInfo=new f("Money: 0",1560,80,150,30,this),this.lifeInfo=new f("Life: 100",1560,120,150,30,this),this.id="game-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[]}static get instance(){var t;return this._instance=(t=this._instance)!=null?t:new A,this._instance}init(){n=new V(this),this.components.push(n),this.components.push(new q(this)),this.components.push(this.waveInfo),this.components.push(this.moneyInfo),this.components.push(this.lifeInfo);const t=new v(1560,160,150,60,"Upgrade",this,"#66CCFF","#77CCFF","#88CCFF");this.components.push(t),t.onClickedHandler.push(()=>{H.setUpgrade()});const s=new v(1560,250,150,60,"Sell",this,"#DD6699","#EE6699","#FF6699");this.components.push(s),s.onClickedHandler.push(()=>{H.setSell()});const i=new v(1560,900,150,60,"Exit",this,"#FFCC66","#FFDD66","#FFEE66");this.components.push(i),i.onClickedHandler.push(()=>{this.components=[],w.switchScreen(M.instance)})}draw(){!this.visible||(r.background("#D9D9D9"),this.components.forEach(t=>{t.draw()}),this.waveInfo.updateText(`Wave: ${n.wave}`),this.moneyInfo.updateText(`Money: ${n.money}`),this.lifeInfo.updateText(`Life: ${Math.round(n.life)}`),H.render(r.mouseX,r.mouseY))}mouseClicked(t,s){super.mouseClicked(t,s),H.onClick(t,s)}}var J="/assets/help.fde16cdb.png";class P extends b{static get instance(){var t;return this._instance=(t=this._instance)!=null?t:new P,this._instance}constructor(){super();this.id="help-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[],this.init(),this.helpImage=r.loadImage(J)}init(){const t=new f("Game Help",Math.round(l*.4),Math.round(c*.02),Math.round(l*.2),Math.round(c*.1),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"help-title");this.components.push(t);const s=new v(Math.round(l*.02),Math.round(c*.02),Math.round(l*.14),Math.round(c*.08),"Back",this);this.components.push(s),s.onClickedHandler.push(()=>{w.switchScreen(M.instance)})}draw(){!this.visible||(this.components.forEach(t=>{t.draw()}),r.image(this.helpImage,l*.02,c*.14,l*.96,c*.84))}}var K="/assets/bgm.146a0df4.mp3";class Q{constructor(t,s,i,e,o="#ffffff",h="#07D270",a,u=!1,m,g=!1){var k,C,S,y;this.checked=!1,this.onClickedHandler=[],this.mouseDownHandler=[],this.mouseUpHandler=[],this.id=(k=m!=null?m:`${e==null?void 0:e.id}-button-${t}-${s}`)!=null?k:`bare-button-${t}-${s}`,this.x=u?(C=e==null?void 0:e.x)!=null?C:0+t:t,this.y=u?(S=e==null?void 0:e.y)!=null?S:0+s:s,this.width=i,this.height=i,this.defaultColor=o,this.checkedColor=h,this.visible=(y=a!=null?a:e==null?void 0:e.visible)!=null?y:!0,this.parent=e!=null?e:this,this.checked=g!=null?g:!1}draw(){let t=this.height;if(r.fill(this.defaultColor).stroke(0).strokeWeight(1).rect(this.x,this.y,t,t).noStroke(),this.checked){const s=t*.05;t*=.9,r.fill(this.checkedColor).noStroke().rect(this.x+s,this.y+s,t,t)}}onClicked(){this.checked=!this.checked,this.onClickedHandler.forEach(t=>t())}mouseDown(){}mouseUp(){}}class R extends Q{constructor(t,s,i,e,o,h,a=!1,u="#ffffff",m="#07D270",g="#ffffff",k,C=!1,S){super(t,s,e,h,u,m,k,C,S,a);this.width=i,this.text=new f(o,t+e,s,i-e,e,this,g)}draw(){super.draw(),this.text.draw()}}class $ extends b{static get instance(){var t;return this._instance=(t=this._instance)!=null?t:new $,this._instance}constructor(){super();this.id="settings-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[],this.bgm=new Audio(K),this.init()}init(){const t=new f("Game Settings",Math.round(l*.4),Math.round(c*.02),Math.round(l*.2),Math.round(c*.1),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"settings-title");this.components.push(t),x.getInstance().getSetting("backgroundMusic")==="on"&&x.getInstance().setSetting("backgroundMusic","off");const s=new R(576,324,768,50,"Enable Background Music",this,x.getInstance().getSetting("backgroundMusic")==="on");this.components.push(s),s.onClickedHandler.push(()=>{x.getInstance().setSetting("backgroundMusic",s.checked?"on":"off"),this.bgm.currentTime=0,s.checked?this.bgm.play():this.bgm.pause()});const i=new R(576,384,768,50,"Show Enemy Path",this,x.getInstance().getSetting("showEnemyPath")==="on");this.components.push(i),i.onClickedHandler.push(()=>{x.getInstance().setSetting("showEnemyPath",i.checked?"on":"off")});const e=new v(Math.round(l*.02),Math.round(c*.02),Math.round(l*.14),Math.round(c*.08),"Back",this);this.components.push(e),e.onClickedHandler.push(()=>{w.switchScreen(M.instance)})}draw(){!this.visible||this.components.forEach(t=>{t.draw()})}}class M extends b{static get instance(){var t;return this._instance=(t=this._instance)!=null?t:new z,this._instance}constructor(){super();this.id="main-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[],this.init()}init(){const t=new f("Prosperity TD",Math.round(l*.4),Math.round(c*.1),Math.round(l*.2),Math.round(c*.2),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"main-title");this.components.push(t);const s=new v(Math.round(l*.43),Math.round(c*.34),Math.round(l*.14),Math.round(c*.08),"Play",this);this.components.push(s),s.onClickedHandler.push(()=>{A.instance.init(),w.switchScreen(A.instance),console.log("Play Button Clicked")});const i=new v(Math.round(l*.43),Math.round(c*.44),Math.round(l*.14),Math.round(c*.08),"Settings",this);this.components.push(i),i.onClickedHandler.push(()=>{w.switchScreen($.instance),console.log("Settings Button Clicked")});const e=new v(Math.round(l*.43),Math.round(c*.54),Math.round(l*.14),Math.round(c*.08),"Help",this);this.components.push(e),e.onClickedHandler.push(()=>{w.switchScreen(P.instance),console.log("Help Button Clicked")});const o=new v(Math.round(l*.43),Math.round(c*.64),Math.round(l*.14),Math.round(c*.08),"Credits",this);this.components.push(o),o.onClickedHandler.push(()=>{w.switchScreen(z.instance),console.log("Credits Button Clicked")});const h=new f("Version: 0.0.1",Math.round(l*.9),Math.round(c*.95),Math.round(l*.1),Math.round(c*.05),this,"#ffffff","#ffffff","#ffffff");this.components.push(h)}draw(){!this.visible||this.components.forEach(t=>{t.draw()})}}class z extends b{static get instance(){var t;return this._instance=(t=this._instance)!=null?t:new z,this._instance}constructor(){super();this.id="credit-screen",this.x=0,this.y=0,this.width=0,this.height=0,this.visible=!0,this.parent=null,this.components=[],this.init()}init(){const t=new f("Credit",Math.round(l*.4),Math.round(c*.02),Math.round(l*.2),Math.round(c*.1),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"credit-title");this.components.push(t);const s=new v(Math.round(l*.02),Math.round(c*.02),Math.round(l*.14),Math.round(c*.08),"Back",this);this.components.push(s),s.onClickedHandler.push(()=>{w.switchScreen(M.instance)});const i=new f("Designer: Bill Chen",Math.round(l*.4),Math.round(c*.25),Math.round(l*.2),Math.round(c*.06),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"credit-designer");this.components.push(i);const e=new f("Programmer: Bill Chen",Math.round(l*.4),Math.round(c*.35),Math.round(l*.2),Math.round(c*.06),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"credit-programmer");this.components.push(e);const o=new f("Artist: Bill Chen",Math.round(l*.4),Math.round(c*.45),Math.round(l*.2),Math.round(c*.06),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"credit-artist");this.components.push(o);const h=new f("Music: Glorious Morning by Waterflame",Math.round(l*.3),Math.round(c*.55),Math.round(l*.4),Math.round(c*.06),this,"#ffffff","#ffffff","#ffffff",!0,void 0,"credit-music");this.components.push(h)}draw(){!this.visible||this.components.forEach(t=>{t.draw()})}}let W=!1;function Z(){W||(x.getInstance().loadSettingsFromCookies(),w.registerScreen(M.instance),w.registerScreen(P.instance),w.registerScreen($.instance),w.registerScreen(A.instance),w.registerScreen(z.instance),w.showScreen(M.instance),W=!0)}var et=`#app {
  font-family: Avenir, Helvetica, Arial, sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
  color: #2c3e50;
  margin-top: 60px;
}
`;let l,c,r;new X(d=>{r=d,r.setup=function(){r.createCanvas(1920,1080),r.rectMode(r.CORNER).noFill().frameRate(60),l=r.width,c=r.height,Z()},r.draw=function(){r.background(0),w.draw()},r.mousePressed=()=>{var t;(t=w.getCurrentScreen())==null||t.mouseDown(r.mouseX,r.mouseY)},r.mouseReleased=()=>{var t;(t=w.getCurrentScreen())==null||t.mouseUp(r.mouseX,r.mouseY)},r.mouseClicked=()=>{var t;(t=w.getCurrentScreen())==null||t.mouseClicked(r.mouseX,r.mouseY)},r.mouseMoved=()=>{var t;(t=w.getCurrentScreen())==null||t.mouseMoved(r.mouseX,r.mouseY)},r.windowResized=()=>{}},document.getElementById("app"));
